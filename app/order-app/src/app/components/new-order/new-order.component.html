j<div class="new-order-container">
  <!-- Search and Product Selection View (always visible unless success/error) -->
  <div *ngIf="currentStep !== 'success' && currentStep !== 'error'" class="search-view">
    <app-product-search
      [searchQuery]="searchQuery"
      [isSearching]="isSearching"
      [searchResults]="searchResults"
      [searchError]="searchError"
      [searchErrorType]="searchErrorType"
      [searchErrorMessage]="searchErrorMessage"
      [selectedProduct]="selectedProduct"
      (searchQueryChange)="onSearchQueryChange($event)"
      (searchResultsChange)="onSearchResultsChange($event)"
      (isSearchingChange)="onIsSearchingChange($event)"
      (searchErrorChange)="onSearchErrorChange($event)"
      (searchErrorTypeChange)="onSearchErrorTypeChange($event)"
      (searchErrorMessageChange)="onSearchErrorMessageChange($event)"
      (productSelected)="onProductSelected($event)"
      (retrySearchRequested)="onRetrySearchRequested()">
    </app-product-search>

    <div class="content-area">
      <app-product-details
        [selectedProduct]="selectedProduct"
        [isRefreshingPrices]="isRefreshingPrices"
        (refreshPricesRequested)="onRefreshPricesRequested()"
        (addToCartRequested)="onAddToCartRequested($event)">
      </app-product-details>

      <app-cart
        [cart$]="cart$"
        [sourcing$]="sourcing$"
        (quantityUpdated)="onQuantityUpdated($event)"
        (itemRemoved)="onItemRemoved($event)"
        (cartEmptied)="onCartEmptied()"
        (proceedToCustomerRequested)="onProceedToCustomerRequested()"
        (imageError)="onCartImageError($event)">
      </app-cart>
    </div>
  </div>

  <!-- Customer Details Section (appears at bottom) -->
  <div *ngIf="currentStep === 'customer' || currentStep === 'payment'" class="bottom-sections">
        <div *ngIf="currentStep === 'customer' || currentStep === 'payment'" class="customer-section" [class.completed]="currentStep === 'payment'">
      <div class="step-header">
        <button class="back-btn" (click)="goBackToCart()">← {{ 'common.back' | translate }}</button>
        <h2>{{ 'customer.title' | translate }}</h2>
        <div *ngIf="currentStep === 'payment'" class="step-status">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="#4CAF50" stroke-width="2"/>
            <path d="M8 12l2 2 4-4" stroke="#4CAF50" stroke-width="2" fill="none"/>
          </svg>
          <span>{{ 'customer.completed' | translate }}</span>
        </div>
      </div>
    
          <form [formGroup]="customerForm" class="customer-form" [class.readonly]="currentStep === 'payment'">
      <div class="form-section">
        <h3>Personal Information</h3>
        <div class="form-row">
          <div class="form-field">
            <label for="firstName">First name*</label>
            <input type="text" id="firstName" formControlName="firstName" required [readonly]="currentStep === 'payment'">
          </div>
          <div class="form-field">
            <label for="lastName">Last name*</label>
            <input type="text" id="lastName" formControlName="lastName" required [readonly]="currentStep === 'payment'">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-field">
            <label for="email">Email*</label>
            <input type="email" id="email" formControlName="email" required [readonly]="currentStep === 'payment'">
          </div>
          <div class="form-field">
            <label for="phone">Phone number (optional)</label>
            <input type="tel" id="phone" formControlName="phone" [readonly]="currentStep === 'payment'">
          </div>
        </div>
      </div>
      
      <div class="form-section">
        <h3>Address Information</h3>
        <div class="form-field">
          <label for="addressLine1">Address Line 1*</label>
          <input type="text" id="addressLine1" formControlName="addressLine1" required [readonly]="currentStep === 'payment'">
        </div>
        
        <div class="form-field">
          <label for="addressLine2">Address Line 2</label>
          <input type="text" id="addressLine2" formControlName="addressLine2" [readonly]="currentStep === 'payment'">
        </div>
        
        <div class="form-row">
          <div class="form-field">
            <label for="zipCode">Zip Code*</label>
            <input type="text" id="zipCode" formControlName="zipCode" required [readonly]="currentStep === 'payment'">
          </div>
          <div class="form-field">
            <label for="city">City*</label>
            <input type="text" id="city" formControlName="city" required [readonly]="currentStep === 'payment'">
          </div>
        </div>
        
        <div class="form-field">
          <label for="country">Country*</label>
          <input type="text" id="country" formControlName="country" required [readonly]="currentStep === 'payment'">
        </div>
      </div>
      
      <div class="form-section">
        <h3>Shipping option</h3>
        <div class="shipping-options">
          <label *ngFor="let option of shippingOptions" class="shipping-option" [class.selected]="selectedShipping.id === option.id">
            <input type="radio" 
                   [value]="option.id" 
                   [(ngModel)]="selectedShipping" 
                   [ngModelOptions]="{standalone: true}"
                   [disabled]="currentStep === 'payment'"
                   (change)="selectedShipping = option">
            <span class="radio-custom"></span>
            <div class="option-details">
              <span class="option-name">{{ option.name }} ({{ option.price | currency:'EUR':'symbol':'1.2-2' }})</span>
              <span class="option-description">Delivery: {{ option.estimatedDays }} days</span>
            </div>
          </label>
        </div>
      </div>
      
      <div *ngIf="currentStep === 'customer'" class="form-actions">
        <button type="button" class="cancel-btn" (click)="goBackToCart()">Cancel Order</button>
        <button type="button" 
                class="continue-btn" 
                [disabled]="!customerForm.valid"
                (click)="proceedToPayment()">Continue to Payment</button>
      </div>
    </form>
    </div>

    <!-- Payment Section -->
    <div *ngIf="currentStep === 'payment'" class="payment-section">
    <div class="step-header">
      <button class="back-btn" (click)="goBackToCustomer()">← Back</button>
      <h2>Payment option</h2>
    </div>
    
    <div class="payment-content">
      <div class="payment-options">
        <label *ngFor="let option of paymentOptions" class="payment-option">
          <input type="radio" 
                 [value]="option.id" 
                 [(ngModel)]="selectedPayment" 
                 [ngModelOptions]="{standalone: true}"
                 (change)="selectedPayment = option">
          <span class="radio-custom"></span>
          <div class="option-details">
            <span class="option-name">{{ option.name }}</span>
            <span class="option-description">{{ option.description }}</span>
          </div>
        </label>
      </div>
      
      <div class="form-actions">
        <button type="button" class="cancel-btn" (click)="goBackToCart()">Cancel Order</button>
        <button type="button" class="place-order-btn" (click)="placeOrder()">Place Order</button>
      </div>
    </div>
    </div>
  </div>

  <!-- Success View -->
  <div *ngIf="currentStep === 'success'" class="success-view">
    <div class="success-content">
      <div class="success-icon">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="10" stroke="#4CAF50" stroke-width="2"/>
          <path d="M8 12l2 2 4-4" stroke="#4CAF50" stroke-width="2" fill="none"/>
        </svg>
      </div>
      <h2>Congratulations! The order has been placed successfully.</h2>
      <p>Order confirmation number: {{ orderConfirmation }}</p>
      <button class="new-order-btn" (click)="startNewOrder()">New Order</button>
    </div>
  </div>

  <!-- Error View -->
  <div *ngIf="currentStep === 'error'" class="error-view">
    <div class="error-content">
      <div class="error-icon">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="10" stroke="#f44336" stroke-width="2"/>
          <path d="M12 8v4m0 4h.01" stroke="#f44336" stroke-width="2"/>
        </svg>
      </div>
      <h2>Order Creation Failed</h2>
      
      <!-- Error message -->
      <div class="error-message" *ngIf="orderErrorMessage">
        <h3>Error Details:</h3>
        <p><strong>{{ orderErrorMessage }}</strong></p>
      </div>
      
      <!-- Technical details (if available) -->
      <div class="error-details" *ngIf="orderErrorDetails">
        <details>
          <summary>Technical Details (for IT support)</summary>
          <pre>{{ orderErrorDetails }}</pre>
        </details>
      </div>
      
      <div class="error-actions">
        <p>Please try again or contact your IT administrator if the problem persists.</p>
        <button class="new-order-btn" (click)="startNewOrder()">Try Again</button>
      </div>
    </div>
  </div>
</div> 
import{P as n,d as i,j as o}from"./chunk-AMPHMTWR.js";var s={production:!0,developmentMode:!1,apiUrl:"/api",enableMockAuth:!1};var d=(()=>{class r{constructor(){this.userSubject=new o(null),this.user$=this.userSubject.asObservable(),this.isAuthenticatedSubject=new o(!1),this.isAuthenticated$=this.isAuthenticatedSubject.asObservable(),this.isLocalDevelopment=this.checkLocalDevelopment(),this.loadUserInfo()}checkLocalDevelopment(){if(s.enableMockAuth!==void 0)return s.enableMockAuth;if(!this.isBrowser())return!1;let t=window.location.hostname,e=window.location.port;return t==="localhost"||t==="127.0.0.1"||t==="0.0.0.0"||e==="4200"||e==="3000"||t.includes("localhost")}loadUserInfo(){return i(this,null,function*(){if(this.isLocalDevelopment){console.log("\u{1F513} Development mode - Authentication disabled (enableMockAuth: "+s.enableMockAuth+")");let t={id:"dev-user",name:"Development User",email:"dev@localhost.com",scopes:["OrderCreator","OrderViewer","Admin"],roles:["Administrator","OrderCreator","OrderViewer"]};this.userSubject.next(t),this.isAuthenticatedSubject.next(!0);return}if(!this.isBrowser()){console.log("\u{1F504} SSR prerendering - Skipping authentication"),this.isAuthenticatedSubject.next(!1);return}try{let t=yield fetch("/user-api/currentUser",{credentials:"include",headers:{Accept:"application/json"}});if(t.ok){let e=yield t.json(),a={id:e.id||e.name,name:e.name||e.displayName,email:e.email,scopes:e.scopes||[],roles:e.roles||[]};this.userSubject.next(a),this.isAuthenticatedSubject.next(!0)}else this.handleAuthError()}catch(t){console.error("Failed to load user info:",t),this.handleAuthError()}})}handleAuthError(){this.userSubject.next(null),this.isAuthenticatedSubject.next(!1),!this.isLocalDevelopment&&this.isBrowser()&&(window.location.href="/login")}getCurrentUser(){return this.userSubject.value}isAuthenticated(){return this.isAuthenticatedSubject.value}hasScope(t){let e=this.getCurrentUser();return e?e.scopes.includes(t):!1}hasRole(t){let e=this.getCurrentUser();return e?e.roles.includes(t):!1}canCreateOrders(){return this.hasScope("OrderCreator")||this.hasRole("OrderCreator")||this.hasRole("Administrator")}canViewOrders(){return this.hasScope("OrderViewer")||this.hasRole("OrderViewer")||this.hasRole("OrderCreator")||this.hasRole("Administrator")}isAdmin(){return this.hasScope("Admin")||this.hasRole("Administrator")}logout(){if(this.isLocalDevelopment){console.log("\u{1F513} Development mode - Logout disabled");return}this.isBrowser()&&(window.location.href="/do/logout")}isLocalDevelopmentMode(){return this.isLocalDevelopment}isBrowser(){return typeof window<"u"}static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275prov=n({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{d as a};

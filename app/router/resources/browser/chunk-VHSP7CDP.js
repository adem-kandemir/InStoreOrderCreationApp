import{P as a,d as i,j as s}from"./chunk-ZITZSLP4.js";var n={production:!0,developmentMode:!1,apiUrl:"/api",enableMockAuth:!1};var m=(()=>{class o{constructor(){this.userSubject=new s(null),this.user$=this.userSubject.asObservable(),this.isAuthenticatedSubject=new s(!1),this.isAuthenticated$=this.isAuthenticatedSubject.asObservable(),this.isLocalDevelopment=this.checkLocalDevelopment(),this.loadUserInfo()}checkLocalDevelopment(){if(n.enableMockAuth!==void 0)return n.enableMockAuth;if(!this.isBrowser())return!1;let r=window.location.hostname,e=window.location.port;return r==="localhost"||r==="127.0.0.1"||r==="0.0.0.0"||e==="4200"||e==="3000"||r.includes("localhost")}loadUserInfo(){return i(this,null,function*(){console.log("\u{1F510} App router authentication - Fetching user info");try{let e=yield fetch("/user-api/currentUser",{credentials:"include",headers:{Accept:"application/json"}});if(e.ok){let t=yield e.json();console.log("\u{1F464} User info from BTP:",t);let c={id:t.id||t.name||t.logonName||"authenticated-user",name:t.name||t.displayName||t.givenName+" "+t.familyName||"Authenticated User",email:t.email||t.mail||"user@company.com",scopes:t.scopes||t.scope||["OrderCreator","OrderViewer","Admin"],roles:t.roles||["Administrator","OrderCreator","OrderViewer"]};this.userSubject.next(c),this.isAuthenticatedSubject.next(!0);return}}catch(e){console.warn("Could not fetch user info from /user-api/currentUser:",e)}console.log("\u{1F504} Using fallback user info");let r={id:"authenticated-user",name:"Authenticated User",email:"user@company.com",scopes:["OrderCreator","OrderViewer","Admin"],roles:["Administrator","OrderCreator","OrderViewer"]};this.userSubject.next(r),this.isAuthenticatedSubject.next(!0)})}handleAuthError(){console.log("\u{1F510} App router handles authentication - no error handling needed")}getCurrentUser(){return this.userSubject.value}isAuthenticated(){return this.isAuthenticatedSubject.value}hasScope(r){let e=this.getCurrentUser();return e?e.scopes.includes(r):!1}hasRole(r){let e=this.getCurrentUser();return e?e.roles.includes(r):!1}canCreateOrders(){return this.hasScope("OrderCreator")||this.hasRole("OrderCreator")||this.hasRole("Administrator")}canViewOrders(){return this.hasScope("OrderViewer")||this.hasRole("OrderViewer")||this.hasRole("OrderCreator")||this.hasRole("Administrator")}isAdmin(){return this.hasScope("Admin")||this.hasRole("Administrator")}logout(){if(this.isLocalDevelopment){console.log("\u{1F513} Development mode - Logout disabled");return}this.isBrowser()&&(window.location.href="/do/logout")}isLocalDevelopmentMode(){return this.isLocalDevelopment}isBrowser(){return typeof window<"u"}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{m as a};
